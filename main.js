(()=>{"use strict";const e="https://nomoreparties.co/v1/wff-cohort-15/users/me",t="https://nomoreparties.co/v1/wff-cohort-15/cards",o=t+"/likes",n=e+"/avatar",r={authorization:"2763cd9f-9006-409d-8ad3-ee41bf99bf04","Content-Type":"application/json"};function c(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}function i(e){return fetch(e,{headers:r}).then((e=>c(e))).catch((e=>(console.log("Ошибка загрузки данных с сервера"),Promise.reject(`Ошибка: ${e}`))))}const u=document.querySelector("#card-template").content;function a(e){const t=e.target.closest(".card"),n=t.dataset.imageId,i=e.target.classList.contains("card__like-button_is-active"),u=t.querySelector(".card__likes_counter");(function(e,t){let n;return n=t?"PUT":"DELETE",fetch(o+"/"+e,{method:n,headers:r}).then((e=>c(e))).catch((e=>(console.log("Ошибка отправки лайка на сервер"),Promise.reject(`Ошибка: ${e}`))))})(n,!i).then((t=>{e.target.classList.toggle("card__like-button_is-active"),t.likes&&(u.textContent=t.likes.length||0)}))}function s(e){document.addEventListener("keydown",d),e.classList.add("popup_is-opened")}function l(e){document.removeEventListener("keydown",d),e.classList.remove("popup_is-opened")}function d(e){"Escape"===e.key&&l(document.querySelector(".popup_is-opened"))}function p(e){const t=e.target;e.target.classList.contains("popup_is-opened")&&l(t)}const m="Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы";let _,f,y,v,S,h;function q(e){_=e.formSelector,f=e.inputSelector,y=e.submitButtonSelector,v=e.inactiveButtonClass,S=e.inputErrorClass,h=e.errorClass}function E(e,t,o=!1){t.validity.patternMismatch?t.setCustomValidity(m):t.setCustomValidity(""),t.validity.valid||o?function(e,t){const o=e.querySelector(`.${t.name}-error`);t.classList.remove(S),o.textContent="",o.classList.remove(h)}(e,t):function(e,t,o){const n=e.querySelector(`.${t.name}-error`);t.classList.add(S),n.textContent=o,n.classList.add(h)}(e,t,t.validationMessage)}function L(e){e.preventDefault()}function k(e,t){!function(e){return e.some((e=>!e.validity.valid))}(e)?function(e){e.removeEventListener("click",L),e.classList.remove(v)}(t):function(e){e.addEventListener("click",L),e.classList.add(v)}(t)}function g(e,t,o=!1){q(t);const n=Array.from(e.querySelectorAll(f));k(n,e.querySelector(y)),n.forEach((t=>{E(e,t,o)}))}const b=document.querySelector(".popup_type_edit"),C=document.querySelector(".popup_type_new-card"),x=document.querySelector(".popup_type_image"),w=document.querySelector(".popup_type_confirmation"),P=document.querySelector(".popup_type_avatar"),A=document.querySelector(".profile__title"),j=document.querySelector(".profile__description"),$=document.querySelector(".popup__image"),T=document.querySelector(".popup__caption"),D=document.querySelector(".places__list"),I=document.querySelector(".profile__add-button"),B=document.querySelector(".profile__edit-button"),N=document.querySelector(".profile__image"),O=b.querySelector(".popup__form"),J=C.querySelector(".popup__form"),H=P.querySelector(".popup__form"),M=w.querySelector(".popup__form"),V=C.querySelector('input[name="place-name"]'),z=C.querySelector('input[name="link"]'),U=b.querySelector('input[name="name"]'),F=b.querySelector('input[name="description"]'),G=P.querySelector('input[name="avatar-link"]'),K=b.querySelector(".popup__close"),Q=C.querySelector(".popup__close"),R=x.querySelector(".popup__close"),W=w.querySelector(".popup__close"),X=P.querySelector(".popup__close"),Y=b.querySelector(".popup__button"),Z=C.querySelector(".popup__button"),ee=P.querySelector(".popup__button"),te={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};let oe,ne=0;function re(e,t,o=600){t?e.textContent="Сохранение…":setTimeout((()=>{e.textContent="Сохранить"}),o)}function ce(e,t){!function(e,t){$.src=e,$.alt=t,T.textContent=t}(e,t),s(x)}function ie(e){oe=e.target.closest(".card"),s(w)}function ue(e,t=!1){const o=function(e,t,o,n,r){const c=u.querySelector(".card").cloneNode(!0),i=c.querySelector(".card__image"),a=c.querySelector(".card__title"),s=c.querySelector(".card__delete-button"),l=c.querySelector(".card__like-button"),d=c.querySelector(".card__likes_counter");return s.addEventListener("click",t),l.addEventListener("click",n),i.addEventListener("click",(()=>o(e.link,e.name))),i.src=e.link,i.alt=e.name,a.textContent=e.name,c.dataset.imageId=e._id||0,e.likes?(d.textContent=e.likes.length||0,e.likes.some((e=>e._id===r))&&l.classList.add("card__like-button_is-active")):d.textContent=0,e.owner?e.owner._id!==r&&s.remove():s.remove(),c}(e,ie,ce,a,ne);t?D.prepend(o):D.append(o)}function ae(e){l(e.target.closest(".popup"))}document.querySelectorAll(".popup").forEach((e=>function(e){e.classList.add("popup_is-animated")}(e))),I.addEventListener("click",(function(){V.value="",z.value="",g(J,te,!0),s(C)})),J.addEventListener("submit",(function(e){e.preventDefault(),re(Z,!0),function(){const e={};return e.name=V.value,e.link=z.value,e.owner={_id:ne},function(e){return fetch(t,{method:"POST",headers:r,body:JSON.stringify(e)}).then((e=>c(e))).then((e=>e._id)).catch((e=>(console.log("Ошибка выгрузки карточки на сервер"),Promise.reject(`Ошибка: ${e}`))))}(e).then((t=>{e._id=t,ue(e,!0)}))}().then((()=>{l(C),re(Z,!1)})).catch((()=>{re(Z,!1,0)}))})),Q.addEventListener("click",ae),C.addEventListener("mousedown",p),B.addEventListener("click",(function(){U.value=A.textContent,F.value=j.textContent,g(O,te),s(b)})),O.addEventListener("submit",(function(t){var o,n;t.preventDefault(),re(Y,!0),(o=U.value,n=F.value,fetch(e,{method:"PATCH",headers:r,body:JSON.stringify({name:o,about:n})}).then((e=>c(e))).catch((e=>(console.log("Ошибка выгрузки профиля на сервер"),Promise.reject(`Ошибка: ${e}`))))).then((e=>{!function(e,t){A.textContent=e,j.textContent=t}(e.name,e.about),l(b),re(Y,!1)})).catch((()=>{re(Y,!1,0)}))})),K.addEventListener("click",ae),b.addEventListener("mousedown",p),R.addEventListener("click",ae),$.addEventListener("click",ae),x.addEventListener("mousedown",p),N.addEventListener("click",(function(){G.value=N.style.backgroundImage.slice(5,-2),g(H,te),s(P)})),H.addEventListener("submit",(function(e){var t;e.preventDefault(),re(ee,!0),(t=G.value,fetch(n,{method:"PATCH",headers:r,body:JSON.stringify({avatar:t})}).then((e=>c(e))).catch((e=>(console.log("Ошибка выгрузки аватара на сервер"),Promise.reject(`Ошибка: ${e}`))))).then((e=>{!function(e){N.style.backgroundImage='url("'+e+'")'}(e.avatar),l(P),re(ee,!1)})).catch((()=>{re(ee,!1,0)}))})),X.addEventListener("click",ae),P.addEventListener("mousedown",p),M.addEventListener("submit",(function(e){const o=oe.dataset.imageId;e.preventDefault(),function(e){return fetch(t+"/"+e,{method:"DELETE",headers:r}).then((e=>c(e))).catch((e=>(console.log("Ошибка удаления карточки на сервере"),Promise.reject(`Ошибка: ${e}`))))}(o).then((()=>{oe.remove(),l(w)}))})),W.addEventListener("click",ae),w.addEventListener("mousedown",p),function(e){q(e),Array.from(document.querySelectorAll(_)).forEach((t=>{!function(e,t){const o=Array.from(e.querySelectorAll(f)),n=e.querySelector(y);k(o,n),o.forEach((t=>{t.addEventListener("input",(()=>{E(e,t),k(o,n)}))})),n.addEventListener("click",(o=>{g(e,t)}))}(t,e)}))}(te),document.querySelectorAll(".card").forEach((e=>{e.remove()})),Promise.all([i(e),i(t)]).then((e=>{!function(e){A.textContent=e.name,j.textContent=e.about,N.style.backgroundImage='url("'+e.avatar+'")',ne=e._id}(e[0]),e[1].forEach((e=>{ue(e)}))})).catch((()=>{console.log("Ошибка загрузки данных с сервера")}))})();
//# sourceMappingURL=main.js.map