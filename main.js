(()=>{"use strict";const e="https://nomoreparties.co/v1/wff-cohort-15/users/me",t="https://nomoreparties.co/v1/wff-cohort-15/cards",o=t+"/likes",n=e+"/avatar",r={authorization:"2763cd9f-9006-409d-8ad3-ee41bf99bf04","Content-Type":"application/json"};function c(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}function a(e){return fetch(e,{headers:r}).then((e=>c(e))).catch((e=>(console.log("Ошибка загрузки данных с сервера"),Promise.reject(`Ошибка: ${e}`))))}const i=document.querySelector("#card-template").content;function u(e){const t=e.target.closest(".card"),n=t.dataset.imageId,a=e.target.classList.contains("card__like-button_is-active"),i=t.querySelector(".card__likes_counter");(function(e,t){let n;return n=t?"PUT":"DELETE",fetch(o+"/"+e,{method:n,headers:r}).then((e=>c(e))).catch((e=>(console.log("Ошибка отправки лайка на сервер"),Promise.reject(`Ошибка: ${e}`))))})(n,!a).then((t=>{e.target.classList.toggle("card__like-button_is-active"),t.likes&&(i.textContent=t.likes.length||0)})).catch((()=>{console.log("Ошибка отправки лайка на сервер")}))}function l(e){document.addEventListener("keydown",d),e.classList.add("popup_is-opened")}function s(e){document.removeEventListener("keydown",d),e.classList.remove("popup_is-opened")}function d(e){"Escape"===e.key&&s(document.querySelector(".popup_is-opened"))}function p(e){const t=e.target;e.target.classList.contains("popup_is-opened")&&s(t)}const m="Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы";let _,f,v,y,S,h;function q(e){_=e.formSelector,f=e.inputSelector,v=e.submitButtonSelector,y=e.inactiveButtonClass,S=e.inputErrorClass,h=e.errorClass}function E(e,t,o=!1){t.validity.patternMismatch?t.setCustomValidity(m):t.setCustomValidity(""),t.validity.valid||o?function(e,t){const o=e.querySelector(`.${t.name}-error`);t.classList.remove(S),o.textContent="",o.classList.remove(h)}(e,t):function(e,t,o){const n=e.querySelector(`.${t.name}-error`);t.classList.add(S),n.textContent=o,n.classList.add(h)}(e,t,t.validationMessage)}function L(e){e.preventDefault()}function k(e,t){!function(e){return e.some((e=>!e.validity.valid))}(e)?function(e){e.removeEventListener("click",L),e.classList.remove(y)}(t):function(e){e.addEventListener("click",L),e.classList.add(y)}(t)}function g(e,t,o=!1){q(t);const n=Array.from(e.querySelectorAll(f));k(n,e.querySelector(v)),n.forEach((t=>{E(e,t,o)}))}const b=document.querySelector(".popup_type_edit"),C=document.querySelector(".popup_type_new-card"),w=document.querySelector(".popup_type_image"),x=document.querySelector(".popup_type_confirmation"),P=document.querySelector(".popup_type_avatar"),j=document.querySelector(".profile__title"),A=document.querySelector(".profile__description"),$=document.querySelector(".popup__image"),I=document.querySelector(".popup__caption"),T=document.querySelector(".places__list"),D=document.querySelector(".profile__add-button"),B=document.querySelector(".profile__edit-button"),N=document.querySelector(".profile__image"),O=b.querySelector(".popup__form"),J=C.querySelector(".popup__form"),H=P.querySelector(".popup__form"),M=x.querySelector(".popup__form"),V=C.querySelector('input[name="place-name"]'),z=C.querySelector('input[name="link"]'),U=b.querySelector('input[name="name"]'),F=b.querySelector('input[name="description"]'),G=P.querySelector('input[name="avatar-link"]'),K=b.querySelector(".popup__close"),Q=C.querySelector(".popup__close"),R=w.querySelector(".popup__close"),W=x.querySelector(".popup__close"),X=P.querySelector(".popup__close"),Y=b.querySelector(".popup__button"),Z=C.querySelector(".popup__button"),ee=P.querySelector(".popup__button"),te={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};let oe,ne=0;function re(e,t,o=600){t?e.textContent="Сохранение…":setTimeout((()=>{e.textContent="Сохранить"}),o)}function ce(e,t){!function(e,t){$.src=e,$.alt=t,I.textContent=t,I.style.whiteSpace="pre"}(e,t),l(w)}function ae(e){oe=e.target.closest(".card"),l(x)}function ie(e,t=!1){const o=function(e,t,o,n,r){const c=i.querySelector(".card").cloneNode(!0),a=c.querySelector(".card__image"),u=c.querySelector(".card__title"),l=c.querySelector(".card__delete-button"),s=c.querySelector(".card__like-button"),d=c.querySelector(".card__likes_counter"),p=c.querySelector(".card__avatar"),m=c.querySelector(".card__avatar-text");return l.addEventListener("click",t),s.addEventListener("click",n),a.addEventListener("click",(()=>o(e.link,e.name))),a.src=e.link,a.alt=e.name,u.textContent=e.name,c.dataset.imageId=e._id||0,e.likes?(d.textContent=e.likes.length||0,e.likes.some((e=>e._id===r))&&s.classList.add("card__like-button_is-active")):d.textContent=0,e.owner?(e.owner._id!==r&&l.remove(),p.style.backgroundImage="url('"+e.owner.avatar+"')",m.textContent=e.owner.name,p.addEventListener("click",(()=>o(e.owner.avatar,e.owner.name+"\n("+e.owner.about+")"))),m.addEventListener("click",(()=>o(e.owner.avatar,e.owner.name+"\n("+e.owner.about+")")))):l.remove(),c}(e,ae,ce,u,ne);t?T.prepend(o):T.append(o)}function ue(e){s(e.target.closest(".popup"))}document.querySelectorAll(".popup").forEach((e=>function(e){e.classList.add("popup_is-animated")}(e))),D.addEventListener("click",(function(){V.value="",z.value="",g(J,te,!0),l(C)})),J.addEventListener("submit",(function(e){e.preventDefault(),re(Z,!0),function(){const e={};return e.name=V.value,e.link=z.value,e.owner={_id:ne},e.owner.avatar=N.style.backgroundImage.slice(5,-2),e.owner.name=j.textContent,e.owner.about=A.textContent,function(e){return fetch(t,{method:"POST",headers:r,body:JSON.stringify(e)}).then((e=>c(e))).then((e=>e._id)).catch((e=>(console.log("Ошибка выгрузки карточки на сервер"),Promise.reject(`Ошибка: ${e}`))))}(e).then((t=>{e._id=t,ie(e,!0)})).catch((e=>(console.log("Ошибка выгрузки карточки на сервер"),Promise.reject(`Ошибка: ${e}`))))}().then((()=>{s(C),re(Z,!1)})).catch((()=>{re(Z,!1,0)}))})),Q.addEventListener("click",ue),C.addEventListener("mousedown",p),B.addEventListener("click",(function(){U.value=j.textContent,F.value=A.textContent,g(O,te),l(b)})),O.addEventListener("submit",(function(t){var o,n;t.preventDefault(),re(Y,!0),(o=U.value,n=F.value,fetch(e,{method:"PATCH",headers:r,body:JSON.stringify({name:o,about:n})}).then((e=>c(e))).catch((e=>(console.log("Ошибка выгрузки профиля на сервер"),Promise.reject(`Ошибка: ${e}`))))).then((e=>{!function(e,t){j.textContent=e,A.textContent=t}(e.name,e.about),s(b),re(Y,!1)})).catch((()=>{re(Y,!1,0)}))})),K.addEventListener("click",ue),b.addEventListener("mousedown",p),R.addEventListener("click",ue),$.addEventListener("click",ue),w.addEventListener("mousedown",p),N.addEventListener("click",(function(){G.value=N.style.backgroundImage.slice(5,-2),g(H,te),l(P)})),H.addEventListener("submit",(function(e){var t;e.preventDefault(),re(ee,!0),(t=G.value,fetch(n,{method:"PATCH",headers:r,body:JSON.stringify({avatar:t})}).then((e=>c(e))).catch((e=>(console.log("Ошибка выгрузки аватара на сервер"),Promise.reject(`Ошибка: ${e}`))))).then((e=>{!function(e){N.style.backgroundImage='url("'+e+'")'}(e.avatar),s(P),re(ee,!1)})).catch((()=>{re(ee,!1,0)}))})),X.addEventListener("click",ue),P.addEventListener("mousedown",p),M.addEventListener("submit",(function(e){const o=oe.dataset.imageId;e.preventDefault(),function(e){return fetch(t+"/"+e,{method:"DELETE",headers:r}).then((e=>c(e))).catch((e=>(console.log("Ошибка удаления карточки на сервере"),Promise.reject(`Ошибка: ${e}`))))}(o).then((()=>{oe.remove(),s(x)})).catch((()=>{console.log("Ошибка удаления карточки на сервере")}))})),W.addEventListener("click",ue),x.addEventListener("mousedown",p),function(e){q(e),Array.from(document.querySelectorAll(_)).forEach((t=>{!function(e,t){const o=Array.from(e.querySelectorAll(f)),n=e.querySelector(v);k(o,n),o.forEach((t=>{t.addEventListener("input",(()=>{E(e,t),k(o,n)}))})),n.addEventListener("click",(o=>{g(e,t)}))}(t,e)}))}(te),document.querySelectorAll(".card").forEach((e=>{e.remove()})),Promise.all([a(e),a(t)]).then((e=>{!function(e){j.textContent=e.name,A.textContent=e.about,N.style.backgroundImage='url("'+e.avatar+'")',ne=e._id}(e[0]),e[1].forEach((e=>{ie(e)}))})).catch((()=>{console.log("Ошибка загрузки данных с сервера")}))})();
//# sourceMappingURL=main.js.map