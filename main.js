(()=>{"use strict";var e={117:(e,t,n)=>{e.exports=n.p+"6666407ac3aa5af1d5de.jpg"}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var c=t[o]={exports:{}};return e[o](c,c.exports,n),c.exports}n.m=e,n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.p="",n.b=document.baseURI||self.location.href,(()=>{const e=[{name:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{name:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{name:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{name:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{name:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{name:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}],t="2763cd9f-9006-409d-8ad3-ee41bf99bf04",o="https://nomoreparties.co/v1/wff-cohort-15/users/me",r="https://nomoreparties.co/v1/wff-cohort-15/cards",c=r+"/likes",a=o+"/avatar";function i(e){return fetch(e,{headers:{authorization:t}})}const s=document.querySelector("#card-template").content;function u(e){const n=e.target.closest(".card"),o=n.dataset.imageId,r=e.target.classList.contains("card__like-button_is-active"),a=n.querySelector(".card__likes_counter");e.target.classList.toggle("card__like-button_is-active"),function(e,n,o){(function(e,n){let o;return o=n?"PUT":"DELETE",fetch(c+"/"+e,{method:o,headers:{authorization:t}}).then((e=>e.ok?e.json():Promise.reject()))})(e,n).then((e=>{e.likes&&(o.textContent=e.likes.length||0)})).catch((()=>{console.log("Ошибка отправки лайка на сервер"),loadDataFromServer()}))}(o,!r,a)}function l(e){document.addEventListener("keydown",p),e.classList.add("popup_is-opened")}function d(e){document.removeEventListener("keydown",p),e.classList.remove("popup_is-opened")}function p(e){"Escape"===e.key&&d(document.querySelector(".popup_is-opened"))}function m(e){const t=e.target;e.target.classList.contains("popup_is-opened")&&d(t)}const f="Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы";let _,y,v,h,k,S;function g(e){_=e.formSelector,y=e.inputSelector,v=e.submitButtonSelector,h=e.inactiveButtonClass,k=e.inputErrorClass,S=e.errorClass}function q(e,t,n=!1){t.validity.patternMismatch?t.setCustomValidity(f):t.setCustomValidity(""),t.validity.valid||n?function(e,t){const n=e.querySelector(`.${t.name}-error`);t.classList.remove(k),n.textContent="",n.classList.remove(S)}(e,t):function(e,t,n){const o=e.querySelector(`.${t.name}-error`);t.classList.add(k),o.textContent=n,o.classList.add(S)}(e,t,t.validationMessage)}function E(e){e.preventDefault()}function L(e,t){!function(e){return e.some((e=>!e.validity.valid))}(e)?function(e){e.removeEventListener("click",E),e.classList.remove(h)}(t):function(e){e.addEventListener("click",E),e.classList.add(h)}(t)}function b(e,t,n=!1){g(t);const o=Array.from(e.querySelectorAll(y));L(o,e.querySelector(v)),o.forEach((t=>{q(e,t,n)}))}const C=document.querySelector(".popup_type_edit"),x=document.querySelector(".popup_type_new-card"),j=document.querySelector(".popup_type_image"),w=document.querySelector(".popup_type_confirmation"),P=document.querySelector(".popup_type_avatar"),A=document.querySelector(".profile__title"),T=document.querySelector(".profile__description"),D=document.querySelector(".popup__image"),I=document.querySelector(".popup__caption"),z=document.querySelector(".places__list"),O=document.querySelector(".profile__add-button"),B=document.querySelector(".profile__edit-button"),N=document.querySelector(".profile__image"),H=C.querySelector(".popup__form"),J=x.querySelector(".popup__form"),U=P.querySelector(".popup__form"),M=w.querySelector(".popup__form"),R=x.querySelector('input[name="place-name"]'),V=x.querySelector('input[name="link"]'),$=C.querySelector('input[name="name"]'),F=C.querySelector('input[name="description"]'),G=P.querySelector('input[name="avatar-link"]'),K=C.querySelector(".popup__close"),Q=x.querySelector(".popup__close"),W=j.querySelector(".popup__close"),X=w.querySelector(".popup__close"),Y=P.querySelector(".popup__close"),Z=C.querySelector(".popup__button"),ee=x.querySelector(".popup__button"),te=P.querySelector(".popup__button"),ne={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},oe={about:"Исследователь океана",avatar:new URL(n(117),n.b),name:"Жак-Ив Кусто",_id:0};let re,ce=0;function ae(e,t){t?e.textContent="Сохранение…":setTimeout((()=>{e.textContent="Сохранить"}),600)}function ie(e,t){!function(e,t){D.src=e,D.alt=t,I.textContent=t}(e,t),l(j)}function se(e){re=e.target.closest(".card"),l(w)}function ue(e,t=!1){const n=function(e,t,n,o,r){const c=s.querySelector(".card").cloneNode(!0),a=c.querySelector(".card__image"),i=c.querySelector(".card__title"),u=c.querySelector(".card__delete-button"),l=c.querySelector(".card__like-button"),d=c.querySelector(".card__likes_counter");return u.addEventListener("click",t),l.addEventListener("click",o),a.addEventListener("click",(()=>n(e.link,e.name))),a.src=e.link,a.alt=e.name,i.textContent=e.name,c.dataset.imageId=e._id||0,e.likes?(d.textContent=e.likes.length||0,e.likes.some((e=>e._id===r))&&l.classList.add("card__like-button_is-active")):d.textContent=0,e.owner?e.owner._id!==r&&u.remove():u.remove(),c}(e,se,ie,u,ce);t?z.prepend(n):z.append(n)}function le(e){e.forEach((e=>{ue(e)}))}function de(e){d(e.target.closest(".popup"))}function pe(e){A.textContent=e.name,T.textContent=e.about,N.style.backgroundImage='url("'+e.avatar+'")',ce=e._id}function me(){document.querySelectorAll(".card").forEach((e=>{e.remove()})),Promise.all([i(o),i(r)]).then((e=>Promise.all(e.map((e=>e.ok?e.json():Promise.reject()))))).then((e=>{pe(e[0]),le(e[1])})).catch((()=>{console.log("Ошибка загрузки данных с сервера"),pe(oe),le(e)}))}document.querySelectorAll(".popup").forEach((e=>function(e){e.classList.add("popup_is-animated")}(e))),O.addEventListener("click",(function(){R.value="",V.value="",b(J,ne,!0),l(x)})),J.addEventListener("submit",(function(e){e.preventDefault(),ae(ee,!0),function(){const e={};return e.name=R.value,e.link=V.value,e.owner={_id:ce},function(e){return function(e){return fetch(r,{method:"POST",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.ok?e.json():Promise.reject()))}(e).then((e=>e._id)).catch((()=>{console.log("Ошибка выгрузки карточки на сервер"),me()}))}(e).then((t=>{e._id=t,ue(e,!0)}))}().finally((()=>{d(x),ae(ee,!1)}))})),Q.addEventListener("click",de),x.addEventListener("mousedown",m),B.addEventListener("click",(function(){$.value=A.textContent,F.value=T.textContent,b(H,ne),l(C)})),H.addEventListener("submit",(function(e){var n,r;e.preventDefault(),ae(Z,!0),A.textContent=$.value,T.textContent=F.value,(n=A.textContent,r=T.textContent,fetch(o,{method:"PATCH",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({name:n,about:r})}).then((e=>{if(!e.ok)return Promise.reject()}))).catch((()=>{console.log("Ошибка выгрузки профиля на сервер"),me()})).finally((()=>{d(C),ae(Z,!1)}))})),K.addEventListener("click",de),C.addEventListener("mousedown",m),W.addEventListener("click",de),D.addEventListener("click",de),j.addEventListener("mousedown",m),N.addEventListener("click",(function(){G.value=N.style.backgroundImage.slice(5,-2),b(U,ne),l(P)})),U.addEventListener("submit",(function(e){var n;e.preventDefault(),ae(te,!0),N.style.backgroundImage='url("'+G.value+'")',(n=N.style.backgroundImage.slice(5,-2),function(e){return fetch(e,{method:"HEAD"}).then((e=>{if(!e.ok||!e.headers.get("Content-Type").includes("image"))return console.log("Ошибка: некорректная ссылка"),Promise.reject()})).catch((()=>(console.log("Ошибка проверки ссылки"),Promise.reject())))}(n).then((()=>fetch(a,{method:"PATCH",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({avatar:n})}))).then((e=>{if(!e.ok)return Promise.reject()}))).catch((()=>{console.log("Ошибка выгрузки аватара на сервер"),me()})).finally((()=>{d(P),ae(te,!1)}))})),Y.addEventListener("click",de),P.addEventListener("mousedown",m),M.addEventListener("submit",(function(e){const n=re.dataset.imageId;e.preventDefault(),re.remove(),function(e){return function(e){return fetch(r+"/"+e,{method:"DELETE",headers:{authorization:t}}).then((e=>{if(!e.ok)return Promise.reject()}))}(e).catch((()=>{console.log("Ошибка удаления карточки на сервере"),me()}))}(n).finally((()=>{d(w)}))})),X.addEventListener("click",de),w.addEventListener("mousedown",m),function(e){g(e),Array.from(document.querySelectorAll(_)).forEach((t=>{!function(e,t){const n=Array.from(e.querySelectorAll(y)),o=e.querySelector(v);L(n,o),n.forEach((t=>{t.addEventListener("input",(()=>{q(e,t),L(n,o)}))})),o.addEventListener("click",(n=>{b(e,t)}))}(t,e)}))}(ne),me()})()})();
//# sourceMappingURL=main.js.map